<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cutelee: Generic type and template support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cutelee
   &#160;<span id="projectnumber">6.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Generic type and template support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="generic_types"></a>
Generic type support</h1>
<p>Cutelee offers powerful support for using any type or container in a <a class="el" href="classQVariant.html">QVariant</a> as part of the <a class="el" href="classCutelee_1_1Context.html" title="The Context class holds the context to render a Template with.">Context</a>. Qt introspection based on Q_PROPERTY is the most convenient way to access properties on QObject derived type or types decorated with the <code>Q_GADGET</code> macro. However, sometimes it is necessary to use classes which do can't have Q_PROPERTY macros (perhaps because they are defined in third-party headers) and where it would not be practical to create QObject/<code>Q_GADGET</code> wrappers around all related classes.</p>
<p>In such cases the metatype can be registered with Cutelee and an introspection method can be written.</p>
<div class="fragment"><div class="line"><span class="comment">// Non-QObject</span></div>
<div class="line"><span class="keyword">class </span><a class="code" href="classPerson.html">Person</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code" href="classPerson.html">Person</a>() :age(0) {}</div>
<div class="line">  <a class="code" href="classPerson.html">Person</a>(<span class="keyword">const</span> <a class="code" href="classQString.html">QString</a> &amp;name, <span class="keywordtype">int</span> age)</div>
<div class="line">    : m_name(name), m_age(age)</div>
<div class="line">  {</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classQString.html">QString</a> name()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> m_name;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> age()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> m_age;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <a class="code" href="classQString.html">QString</a> m_name;</div>
<div class="line">  <span class="keywordtype">int</span> m_age;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Make it possible to put Person in a QVariant.</span></div>
<div class="line">Q_DECLARE_METATYPE(<a class="code" href="classPerson.html">Person</a>)</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read-only introspection of Person object.</span></div>
<div class="line"><a class="code" href="metatype_8h.html#a4a7369f585d9f85ccdd20b5acd9d92af">CUTELEE_BEGIN_LOOKUP</a>(<a class="code" href="classPerson.html">Person</a>)</div>
<div class="line">  <span class="keywordflow">if</span> ( property == <span class="stringliteral">&quot;name&quot;</span> )</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keywordtype">object</span>.name();</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( property == <span class="stringliteral">&quot;age&quot;</span> )</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keywordtype">object</span>.age();</div>
<div class="line"><a class="code" href="metatype_8h.html#abf77d9eeaeacfc68d0459956d649b8fd">CUTELEE_END_LOOKUP</a></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> someInitializer()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Register the Person type with the %Cutelee introspection system.</span></div>
<div class="line">  Cutelee::registerMetaType&lt;Person&gt;();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> getContext()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> c;</div>
<div class="line">  <a class="code" href="classPerson.html">Person</a> leader(<span class="stringliteral">&quot;The Leader&quot;</span>, 19);</div>
<div class="line"> </div>
<div class="line">  QList&lt;Person&gt; followers;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; ++i)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classPerson.html">Person</a> follower(<span class="stringliteral">&quot;Follower&quot;</span> + QString::number(i), 18);</div>
<div class="line">    people.append(follower);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  c.<a class="code" href="classCutelee_1_1Context.html#aa542a29977b1e2ba4b63f28c526ab048">insert</a>(<span class="stringliteral">&quot;leader&quot;</span>, QVariant::fromValue(leader));</div>
<div class="line">  c.<a class="code" href="classCutelee_1_1Context.html#aa542a29977b1e2ba4b63f28c526ab048">insert</a>(<span class="stringliteral">&quot;followers&quot;</span>, QVariant::fromValue(followers));</div>
<div class="line">  <span class="keywordflow">return</span> c;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classQString.html">QString</a> createOutput()</div>
<div class="line">{</div>
<div class="line">  Template t = m_engine-&gt;newTemplate(</div>
<div class="line">    <span class="stringliteral">&quot;&lt;h1&gt;{{ leader.name }}&lt;/h1&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;&lt;ul&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{% for person in followers %}&quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;&lt;li&gt;{{ person.name }}, {{ person.age }}&lt;/li&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{% endfor %}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">  Context c = getContext();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> t-&gt;render(&amp;c);</div>
<div class="line">}</div>
<div class="ttc" id="aclassCutelee_1_1Context_html"><div class="ttname"><a href="classCutelee_1_1Context.html">Cutelee::Context</a></div><div class="ttdoc">The Context class holds the context to render a Template with.</div><div class="ttdef"><b>Definition:</b> <a href="context_8h_source.html#l00118">context.h:119</a></div></div>
<div class="ttc" id="aclassCutelee_1_1Context_html_aa542a29977b1e2ba4b63f28c526ab048"><div class="ttname"><a href="classCutelee_1_1Context.html#aa542a29977b1e2ba4b63f28c526ab048">Cutelee::Context::insert</a></div><div class="ttdeci">void insert(const QString &amp;name, QObject *object)</div><div class="ttdef"><b>Definition:</b> <a href="context_8cpp_source.html#l00145">context.cpp:145</a></div></div>
<div class="ttc" id="aclassPerson_html"><div class="ttname"><a href="classPerson.html">Person</a></div><div class="ttdef"><b>Definition:</b> <a href="testgenerictypes_8cpp_source.html#l00086">testgenerictypes.cpp:87</a></div></div>
<div class="ttc" id="aclassQString_html"><div class="ttname"><a href="classQString.html">QString</a></div><div class="ttdef"><b>Definition:</b> <a href="operatorcasttests_8cpp_source.html#l00023">operatorcasttests.cpp:24</a></div></div>
<div class="ttc" id="ametatype_8h_html_a4a7369f585d9f85ccdd20b5acd9d92af"><div class="ttname"><a href="metatype_8h.html#a4a7369f585d9f85ccdd20b5acd9d92af">CUTELEE_BEGIN_LOOKUP</a></div><div class="ttdeci">#define CUTELEE_BEGIN_LOOKUP(Type)</div><div class="ttdef"><b>Definition:</b> <a href="metatype_8h_source.html#l00213">metatype.h:213</a></div></div>
<div class="ttc" id="ametatype_8h_html_abf77d9eeaeacfc68d0459956d649b8fd"><div class="ttname"><a href="metatype_8h.html#abf77d9eeaeacfc68d0459956d649b8fd">CUTELEE_END_LOOKUP</a></div><div class="ttdeci">#define CUTELEE_END_LOOKUP</div><div class="ttdef"><b>Definition:</b> <a href="metatype_8h_source.html#l00239">metatype.h:239</a></div></div>
</div><!-- fragment --><p>There are several necessary steps and consequences. </p><ul>
<li>The type must be registered as a QMetaType with <code>Q_DECLARE_METATYPE</code>. Note that this is not needed for QObject derived types. </li>
<li>All containers are supported. (See <a class="el" href="generic_types_and_templates.html#generic_containers">Generic container support</a>) </li>
<li>The <code>CUTELEE_BEGIN_LOOKUP</code> and <code>CUTELEE_END_LOOKUP</code> macros help to define the introspection of the type. Between them is the definition of a method with the signature <code><a class="el" href="classQVariant.html">QVariant</a>&#160;getProperty(const&#160;Type&#160;&amp;object,&#160;const&#160;<a class="el" href="classQString.html">QString</a>&#160;&amp;property)</code>. </li>
<li><a class="el" href="namespaceCutelee.html#a39faf6aa385ae5e83f9541e2dcb975f9" title="Registers the type RealType with the metatype system.">Cutelee::registerMetaType</a> must be called at some point in the program before attempting to use the type in a <a class="el" href="classCutelee_1_1Context.html" title="The Context class holds the context to render a Template with.">Context</a>. </li>
<li>The <a class="el" href="classCutelee_1_1Context.html" title="The Context class holds the context to render a Template with.">Context</a> is created and used as normal.</li>
</ul>
<h1><a class="anchor" id="generic_containers"></a>
Generic container support</h1>
<p>Cutelee supports most Qt and STL containers by default if they are registered with the QMetaType system as shown in <a class="el" href="generic_types_and_templates.html#generic_types">Generic type support</a>. Where a container does not have built in support it can easily be added (See <a class="el" href="generic_types_and_templates.html#third_party_containers">Third party containers</a>).</p>
<p>The following containers have built in support:</p>
<ul>
<li>QList&lt;T&gt; </li>
<li>QVector&lt;T&gt; </li>
<li>QSet&lt;T&gt; </li>
<li>QLinkedList&lt;T&gt; </li>
<li>QStack&lt;T&gt; </li>
<li>QQueue&lt;T&gt; </li>
<li>std::vector&lt;T&gt; </li>
<li>std::deque&lt;T&gt; </li>
<li>std::list&lt;T&gt; </li>
<li>QHash&lt;<a class="el" href="classQString.html">QString</a>, T&gt; </li>
<li>QHash&lt;qint16, T&gt; </li>
<li>QHash&lt;qint32, T&gt; </li>
<li>QHash&lt;qint64, T&gt; </li>
<li>QHash&lt;quint16, T&gt; </li>
<li>QHash&lt;quint32, T&gt; </li>
<li>QHash&lt;quint64, T&gt; </li>
<li>QMap&lt;<a class="el" href="classQString.html">QString</a>, T&gt; </li>
<li>QMap&lt;qint16, T&gt; </li>
<li>QMap&lt;qint32, T&gt; </li>
<li>QMap&lt;qint64, T&gt; </li>
<li>QMap&lt;quint16, T&gt; </li>
<li>QMap&lt;quint32, T&gt; </li>
<li>QMap&lt;quint64, T&gt; </li>
<li>std::map&lt;<a class="el" href="classQString.html">QString</a>, T&gt; </li>
<li>std::map&lt;qint16, T&gt; </li>
<li>std::map&lt;qint32, T&gt; </li>
<li>std::map&lt;qint64, T&gt; </li>
<li>std::map&lt;quint16, T&gt; </li>
<li>std::map&lt;quint32, T&gt; </li>
<li>std::map&lt;quint64, T&gt;</li>
</ul>
<p>where T is one of</p>
<ul>
<li>bool </li>
<li>qint16 </li>
<li>qint32 </li>
<li>qint64 </li>
<li>quint16 </li>
<li>quint32 </li>
<li>quint64 </li>
<li>float </li>
<li>double </li>
<li><a class="el" href="classQVariant.html">QVariant</a> </li>
<li><a class="el" href="classQString.html">QString</a> </li>
<li>QDateTime </li>
<li>A pointer to a type which inherits QObject </li>
<li>Any type registered with <a class="el" href="namespaceCutelee.html#a39faf6aa385ae5e83f9541e2dcb975f9" title="Registers the type RealType with the metatype system.">Cutelee::registerMetaType</a> </li>
<li>Any supported container</li>
</ul>
<p>Note that QSet&lt;T&gt; is an exception and will only work with types for which <code>qHash(T)</code> is defined. This means that QSet&lt;<a class="el" href="classQVariant.html">QVariant</a>&gt; is not possible for example.</p>
<p>Note also that containers of pointers to QObject derived types can be stored in containers, and they do not need to be explicitly registered with Cutelee. Where the class has sufficient <code>Q_PROPERTY</code>s defined, the introspection method described above with <code>CUTELEE_BEGIN_LOOKUP</code> and <code>CUTELEE_END_LOOKUP</code> is also not necessary. Note also that any type or container can be used through a <code>Q_PROPERTY</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="classPersonObject.html">PersonObject</a> : <span class="keyword">public</span> QObject</div>
<div class="line">{</div>
<div class="line">  Q_OBJECT</div>
<div class="line">  Q_PROPERTY(<a class="code" href="classQString.html">QString</a> name READ name)</div>
<div class="line">  Q_PROPERTY(<span class="keywordtype">int</span> age READ age)</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code" href="classPersonObject.html">PersonObject</a>(<span class="keyword">const</span> <a class="code" href="classQString.html">QString</a> &amp;name, <span class="keywordtype">int</span> age, QObject *parent = 0);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classQString.html">QString</a> name() <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">int</span> age() <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>SportsClub : <span class="keyword">public</span> QObject</div>
<div class="line">{</div>
<div class="line">  Q_OBJECT</div>
<div class="line">  Q_PROPERTY(<a class="code" href="classQString.html">QString</a> name READ name)</div>
<div class="line">  Q_PROPERTY(<a class="code" href="classQString.html">QString</a> sport READ sport)</div>
<div class="line">  Q_PROPERTY(std::vector&lt;QObject*&gt; members READ members)</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  SportsClub(<span class="keyword">const</span> <a class="code" href="classQString.html">QString</a> &amp;name, <span class="keyword">const</span> <a class="code" href="classQString.html">QString</a> &amp;sport, QObject *parent = 0);</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="classQString.html">QString</a> name() <span class="keyword">const</span>;</div>
<div class="line">  <a class="code" href="classQString.html">QString</a> sport() <span class="keyword">const</span>;</div>
<div class="line">  std::vector&lt;QObject*&gt; members() <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">void</span> setMembers(std::vector&lt;QObject*&gt; members);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> someInitializer()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// QObject* already has built in support. No need to register the types</span></div>
<div class="line">  <span class="comment">// with Cutelee::registerMetaType</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> SomeClass::getContext()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> c;</div>
<div class="line"> </div>
<div class="line">  QSet&lt;QObject*&gt; clubs;</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">auto</span> club = <span class="keyword">new</span> SportsClub(<span class="stringliteral">&quot;Smithfield Tennis Club&quot;</span>, <span class="stringliteral">&quot;Tennis&quot;</span>, <span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;QObject*&gt; members;</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">auto</span> member = <span class="keyword">new</span> <a class="code" href="classPersonObject.html">PersonObject</a>(<span class="stringliteral">&quot;Alice&quot;</span>, 21, <span class="keyword">this</span>);</div>
<div class="line">      members.push_back(member);</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">auto</span> member = <span class="keyword">new</span> <a class="code" href="classPersonObject.html">PersonObject</a>(<span class="stringliteral">&quot;Bob&quot;</span>, 22, <span class="keyword">this</span>);</div>
<div class="line">      members.push_back(member);</div>
<div class="line">    }</div>
<div class="line">    club.setMembers(members);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// ... specify other clubs and members</span></div>
<div class="line"> </div>
<div class="line">  c.<a class="code" href="classCutelee_1_1Context.html#aa542a29977b1e2ba4b63f28c526ab048">insert</a>(<span class="stringliteral">&quot;sportsClubs&quot;</span>, QVariant::fromValue(clubs));</div>
<div class="line">  <span class="keywordflow">return</span> c;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classQString.html">QString</a> createOutput()</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">auto</span> t = m_engine-&gt;newTemplate(</div>
<div class="line">    <span class="stringliteral">&quot;{% regroup sportsClubs by sport as groupedSports %}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{% for groupedClub in groupedSports %}&quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;&lt;h1&gt;{{ groupedClub.grouper }}&lt;/h1&gt;&quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;{% for club in groupedClub.list %}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;h2&gt;{{ club.name }}&lt;/h2&gt;&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;ul&gt;&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{% for member in club.members %}&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;&lt;li&gt;{{ member.name, }}, {{ member.age }}&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{% endfor %}&quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span></div>
<div class="line">      <span class="stringliteral">&quot;{% endfor %}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{% endfor %}&quot;</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> c = getContext();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> t-&gt;render(&amp;c);</div>
<div class="line">}</div>
<div class="ttc" id="aclassPersonObject_html"><div class="ttname"><a href="classPersonObject.html">PersonObject</a></div><div class="ttdef"><b>Definition:</b> <a href="testgenerictypes_8cpp_source.html#l00129">testgenerictypes.cpp:130</a></div></div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a href="http://docs.djangoproject.com/en/1.9/ref/templates/builtins/#regroup">The regroup tag</a></dd></dl>
<p>The output would be something like</p>
<pre class="fragment">  &lt;h1&gt;Tennis&lt;/h1&gt;
    &lt;h2&gt;Smithfield Tennis Club&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;Alice, 21&lt;/li&gt;
      &lt;li&gt;Bob, 22&lt;/li&gt;
    &lt;/ul&gt;
    &lt;h2&gt;Greenore Lawn Tennis and Fitness Club&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;Charlie, 23&lt;/li&gt;
      &lt;li&gt;David, 24&lt;/li&gt;
      &lt;li&gt;Elaine, 25&lt;/li&gt;
      &lt;li&gt;Frank, 26&lt;/li&gt;
    &lt;/ul&gt;
  &lt;h1&gt;Basketball&lt;/h1&gt;
    &lt;h2&gt;Sandyford Basketball Club&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;Gilian, 27&lt;/li&gt;
      &lt;li&gt;Henry, 28&lt;/li&gt;
    &lt;/ul&gt;
</pre><p>Of course, it is possible to use containers of pointers to concrete QObject subclasses, such as QSet&lt;PersonObject*&gt; and std::vector&lt;SportsClub*&gt; too.</p>
<p>Because any supported container can also be used as a contained type, nested containers such as <code>QVector&lt;QList&lt;PersonObject*&gt;&gt;</code> are also supported.</p>
<p>Note that if a type is registered with <a class="el" href="namespaceCutelee.html#a39faf6aa385ae5e83f9541e2dcb975f9" title="Registers the type RealType with the metatype system.">Cutelee::registerMetaType</a>, built in containers of that type do not also need to be registered. Third party containers do need to be registered however (See <a class="el" href="generic_types_and_templates.html#third_party_containers">Third party containers</a>)</p>
<div class="fragment"><div class="line">Q_DECLARE_METATYPE(<a class="code" href="classPerson.html">Person</a>)</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> someInitializer()</div>
<div class="line">{</div>
<div class="line">  Cutelee::registerMetaType&lt;Person&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Now any of the nested containers can be put </span></div>
<div class="line">  <span class="comment">// in a Context and used in a Template.</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="third_party_containers"></a>
Third party containers</h1>
<p>To support another, non-built in container it is necessary to use some macros to register it with Cutelee.</p>
<p>For a sequential container, <code>Q_DECLARE_SEQUENTIAL_CONTAINER_METATYPE</code>, and <code>Q_DECLARE_ASSOCIATIVE_CONTAINER_METATYPE</code> are needed.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/circular_buffer&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Enable looping over the contents of the container</span></div>
<div class="line">Q_DECLARE_SEQUENTIAL_CONTAINER_METATYPE(boost::circular_buffer)</div>
<div class="line"> </div>
<div class="line">Q_DECLARE_METATYPE(boost::circular_buffer&lt;Person&gt;)</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> someInitializer()</div>
<div class="line">{</div>
<div class="line">  Cutelee::registerMetaType&lt;Person&gt;();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> getContext()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> c;</div>
<div class="line"> </div>
<div class="line">  boost::circular_buffer&lt;Person&gt; buffer(5);</div>
<div class="line">  <span class="comment">// loop</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classPerson.html">Person</a> p(<span class="stringliteral">&quot;Grant&quot;</span>, 21);</div>
<div class="line">    b.push_back(p);</div>
<div class="line">  }</div>
<div class="line">  c.<a class="code" href="classCutelee_1_1Context.html#aa542a29977b1e2ba4b63f28c526ab048">insert</a>(<span class="stringliteral">&quot;people&quot;</span>, QVariant::fromValue(buffer));</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="for_themers.html#lookups">Variable lookups</a></dd></dl>
<p>For associative containers <code>Q_DECLARE_ASSOCIATIVE_CONTAINER_METATYPE</code> is needed.</p>
<h1><a class="anchor" id="smart_pointers"></a>
Smart Pointers</h1>
<p>Shared pointer types containing a custom type should be introspected as normal using <code>CUTELEE_BEGIN_LOOKUP</code> and <code>CUTELEE_END_LOOKUP</code></p>
<div class="fragment"><div class="line">Q_DECLARE_METATYPE(std::shared_ptr&lt;Person&gt;)</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> someInitializer()</div>
<div class="line">{</div>
<div class="line">  Cutelee::registerMetaType&lt;std::shared_ptr&lt;Person&gt; &gt;();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="metatype_8h.html#a4a7369f585d9f85ccdd20b5acd9d92af">CUTELEE_BEGIN_LOOKUP</a>(std::shared_ptr&lt;Person&gt;)</div>
<div class="line">  <span class="keywordflow">if</span> (property == <span class="stringliteral">&quot;name&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keywordtype">object</span>-&gt;name();</div>
<div class="line"><a class="code" href="metatype_8h.html#abf77d9eeaeacfc68d0459956d649b8fd">CUTELEE_END_LOOKUP</a></div>
</div><!-- fragment --><p>Note that if only shared pointers to the type is in your introspectable API you only need to define the property access for the shared pointer. In the case above, there is no need to use <code>Q_DECLARE_METATYPE</code> or <code>CUTELEE_BEGIN_LOOKUP</code> with <code><a class="el" href="classPerson.html">Person</a></code> or <code>Person*</code>.</p>
<p>This is of course true of any smart pointer:</p>
<div class="fragment"><div class="line">Q_DECLARE_METATYPE(boost::shared_ptr&lt;Person&gt;)</div>
<div class="line"> </div>
<div class="line"><a class="code" href="metatype_8h.html#a4a7369f585d9f85ccdd20b5acd9d92af">CUTELEE_BEGIN_LOOKUP</a>(boost::shared_ptr&lt;Person&gt;)</div>
<div class="line">  <span class="keywordflow">if</span> (property == <span class="stringliteral">&quot;name&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keywordtype">object</span>-&gt;name();</div>
<div class="line"><a class="code" href="metatype_8h.html#abf77d9eeaeacfc68d0459956d649b8fd">CUTELEE_END_LOOKUP</a></div>
</div><!-- fragment --><p>std::shared_ptrs containing QObject derived types get special treatment.</p>
<p>QObjects are automatically introspected for their <code>Q_PROPERTY</code>s (See <a class="el" href="for_app_dev.html#custom_objects">Custom objects</a>).</p>
<p>If you have std::shared_ptr&lt;<a class="el" href="classPersonObject.html">PersonObject</a>&gt; where <code><a class="el" href="classPersonObject.html">PersonObject</a></code> is derived from QObject it will be automatically introspected just like a QObject* is without requiring the <code>CUTELEE_BEGIN_LOOKUP</code> and <code>CUTELEE_END_LOOKUP</code> macros, the <code>Q_DECLARE_METATYPE</code> macro, or registration with the Cutelee metatype system. All of the access registration is handled by Qt.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> getContext()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> c;</div>
<div class="line">  <span class="keyword">auto</span> p = std::shared_ptr&lt;PersonObject&gt;::create();</div>
<div class="line">  c.<a class="code" href="classCutelee_1_1Context.html#aa542a29977b1e2ba4b63f28c526ab048">insert</a>(<span class="stringliteral">&quot;person&quot;</span>, QVariant::fromValue(p));</div>
<div class="line">  <span class="keywordflow">return</span> c;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classQString.html">QString</a> createOutput()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Uses Q_PROPERTYs defined on PersonObject for name and age</span></div>
<div class="line">  <span class="keyword">auto</span> t = m_engine-&gt;newTemplate( <span class="stringliteral">&quot;{{ person.name }}, {{ person.age }}&quot;</span> );</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> c = getContext();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> t-&gt;render(&amp;c);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The same technique can be used to support QObject derived types in third party shared pointers, but that requires an extra macro, <code>Q_DECLARE_SMART_POINTER_METATYPE</code>.</p>
<div class="fragment"><div class="line">Q_DECLARE_SMART_POINTER_METATYPE(boost::shared_ptr)</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> getContext()</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classCutelee_1_1Context.html">Cutelee::Context</a> c;</div>
<div class="line">  boost::shared_ptr&lt;PersonObject&gt; p( <span class="keyword">new</span> <a class="code" href="classPersonObject.html">PersonObject</a> );</div>
<div class="line">  c.<a class="code" href="classCutelee_1_1Context.html#aa542a29977b1e2ba4b63f28c526ab048">insert</a>(<span class="stringliteral">&quot;person&quot;</span>, QVariant::fromValue(p));</div>
<div class="line">  <span class="keywordflow">return</span> c;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
